# # ì†Œí”„íŠ¸ì›¨ì–´_í…ŒìŠ¤íŒ…_9

ìƒì„± ì¼ì‹œ: 2023ë…„ 2ì›” 1ì¼ ì˜¤í›„ 1:51

## í”„ë¡œì íŠ¸ ìœ ë‹›í…ŒìŠ¤íŠ¸ ë° í†µí•©í…ŒìŠ¤íŠ¸

<aside>
ğŸŒ± ìŠ¤í”„ë§ ì–´í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ

![Untitled](https://user-images.githubusercontent.com/77047099/218371882-927ff0d7-8825-4f2c-8307-a2ec94753bab.png)

- Web Layer 
- ë¸Œë¼ìš°ì € ìƒ ì›¹ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ ë° ì‘ë‹µì„ ì²˜ë¦¬
- ì„œë¹„ìŠ¤ê³„ì¸µ, ë°ì´í„° ê³„ì¸µì—ì„œ ë°œìƒí•˜ëŠ” Exceptionì²˜ë¦¬
- Service Layer
- íŠ¸ëœì­ì…˜ ê´€ë¦¬
- ì›¹ ê³„ì¸µê³¼ ì €ì¥ì†Œ ê³„ì¸µì´ ì§ì ‘ í†µì‹ í•˜ì§€ ì•Šë„ë¡ ê´€ë¦¬
- ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬ì™€ ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ê´€ë ¨ëœ ë„ë©”ì¸ ëª¨ë¸ì˜ ì í•©ì„± ê²€ì¦
- Repository Layer
- Databaseì— dataë¥¼ CRUDí•˜ëŠ” ê³„ì¸µ
</aside>

### #Service Layer Test

Unit Test â†’ ëª¨ë“ˆê°„ì˜ ë¶„ë¦¬ í•„ìš”, ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í•  í•„ìš”

Service Layer â†’ Web Layerì™€ Repository Layer ì‚¬ì´ì—ì„œ ë™ì‘í•˜ëŠ” ëª¨ë“ˆì´ë‹¤. ë”°ë¼ì„œ Web ê³„ì¸µê³¼ Repository ê³„ì¸µê³¼ì˜ ê´€ê³„ë¥¼ ëŠì€ ì±„ë¡œ Serviceì˜ ê¸°ëŠ¥ë§Œì„ í…ŒìŠ¤íŠ¸í•´ì•¼í•œë‹¤.

**How ?**

â¡ï¸Â Repository ê³„ì¸µì„ Mockìœ¼ë¡œ ìƒì„±í•´ í…ŒìŠ¤íŠ¸ ì§„í–‰

```java
@ExtendWith(MockitoExtension.class)
class ParkServiceTestRefactor {
    @InjectMocks
    private ParkService parkService;
    @Mock
    private ParkRepository parkRepository;

    @Test
    @DisplayName("ë‹¨ê±´ ì¡°íšŒ ê¸°ëŠ¥ TEST")
    void findOne() {
        //given
        Park park = createPark("TEST");
        Long TestId = 1L;
        ReflectionTestUtils.setField(park,"id",TestId);

        //mocking
        given(parkRepository.findParkInfoById(TestId)).willReturn(Optional.of(park));

        //when
        ParkResponseDto find = parkService.findOne(TestId);

        //then
        Assertions.assertThat(find).isNotNull();
        Assertions.assertThat(find.getId()).isEqualTo(park.getId());
        verify(parkRepository).findParkInfoById(any());
    }
    @Test
    @DisplayName("ë‹¤ìˆ˜ ê±´ ì¡°íšŒ TEST")
    void findAll() {
        //given
        List<Park> parks =new ArrayList<>();
        Park park1 = createPark("TEST1");
        Park park2 = createPark("TEST2");
        Park park3 = createPark("TEST3");
        ReflectionTestUtils.setField(park1,"id",1L);
        ReflectionTestUtils.setField(park2,"id",2L);
        ReflectionTestUtils.setField(park3,"id",3L);
        parks.add(park1);
        parks.add(park2);
        parks.add(park3);
        //mocking
        given(parkRepository.findAll()).willReturn(parks);
        //when
        List<Park> finds = parkService.findAll();
        //then
        Assertions.assertThat(finds).isNotNull();
        Assertions.assertThat(finds.size()).isEqualTo(3);
        Assertions.assertThat(finds.get(0)).isEqualTo(parks.get(0));
        Assertions.assertThat(finds.get(1)).isEqualTo(parks.get(1));
        Assertions.assertThat(finds.get(2)).isEqualTo(parks.get(2));
        verify(parkRepository).findAll();
    }
    @Nested
    @DisplayName("When FindOne Is Passed")
    class WhenFindOneIsPassed{
        @Test
        @DisplayName("Park Entity ì¶”ê°€ TEST")
        void addPark() {
            //given
            Park park = createPark("TEST");
            Long Fakeid = 1L;
            ReflectionTestUtils.setField(park,"id",Fakeid);

            //mocking
            given(parkRepository.save(park)).willReturn(park);
            given(parkRepository.findParkInfoById(Fakeid)).willReturn(Optional.of(park));

            //when
            Long saved = parkService.addPark(park);
            Park savedpark = parkRepository.findParkInfoById(saved).get();
            //then
            Assertions.assertThat(savedpark.getId()).isEqualTo(park.getId());
            verify(parkRepository).save(any());
        }
    }
    @Nested
    @DisplayName("When FindAll Is Passed")
    class WhenFindAllisPassed{
        @Test
        @DisplayName("í˜„ì¬ ìœ„ì¹˜ì™€ ê°€ì¥ ê°€ê¹Œìš´ ì£¼ì°¨ì¥ì„ ë°˜í™˜í•˜ëŠ” ê¸°ëŠ¥ TEST")
        void findNearestPark() {
            //given
            List<Park> parks = new ArrayList<>();
            Park park1 = createParkv2("TEST1","TESTLOCAL1",1d,0d);
            Park park2 = createParkv2("TEST2","TESTLOCAL2",3d,0d);
            Park park3 =createParkv2("TEST3","TESTLOCAL3",7d,0d);
            ReflectionTestUtils.setField(park1,"id",1L);
            ReflectionTestUtils.setField(park2,"id",2L);
            ReflectionTestUtils.setField(park3,"id",3L);
            parks.add(park1);
            parks.add(park2);
            parks.add(park3);
            Local testLocal = new Local("TESTLOCAL",4d,0d);

            //mocking
            given(parkRepository.findAll()).willReturn(parks);

            //when
            NearestParkDto find = parkService.findNearestPark(testLocal.getX_pos(), testLocal.getY_pos());

            //then
            Assertions.assertThat(find).isNotNull();
            Assertions.assertThat(find.getId()).isEqualTo(park2.getId());
            verify(parkRepository).findAll();

        }
    }
    private Park createPark(String name)
    {
        String testname=name;
        Local local= new Local("TESTNAME",1.0,1.0);
        Address address= new Address("TEST ADDR DETAIL");
        String content="TEST CONTENT";
        LocalDateTime localDate = null;
        return new Park(name,local,address,content,localDate);
    }
    private Park createParkv2(String name,String localname,double x,double y)
    {
        String testname=name;
        Local local= new Local(localname,x,y);
        Address address= new Address("TEST ADDR DETAIL");
        String content="TEST CONTENT";
        LocalDateTime localDate = null;
        return new Park(name,local,address,content,localDate);
    }
}
```

ParkServiceì˜ ê¸°ëŠ¥

1. findOne â†’ Idë¡œ ì£¼ì°¨ì¥ì„ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥
2. findAll â†’ ëª¨ë“  ì£¼ì°¨ì¥ ì¡°íšŒ
3. findNearestPark â†’ í˜„ì¬ ìœ„ì¹˜ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ì£¼ì°¨ì¥ì„ ì°¾ëŠ” ê¸°ëŠ¥
4. save â†’ Entityë¥¼ ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ 

ParkRepositoryë¥¼ Mockìœ¼ë¡œ ì„ ì–¸í•˜ê³  ParkServiceì— í•´ë‹¹ Mockì„ ì£¼ì….

Service ìì²´ì˜ ê¸°ëŠ¥ë§Œì„ ë…ë¦½ì ìœ¼ë¡œ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.

### Repository Layer Test

@DataJpaTest ë€ ? 

JPAê´€ë ¨ ì„¤ì •ë§Œ ë¡œë“œí•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜

Document â¬‡ï¸

![Untitled 1](https://user-images.githubusercontent.com/77047099/218371886-8e587570-1a14-4730-b897-e1bd65938908.png)

ìš”ì•½ :

1. Full-configurationì´ ì•„ë‹Œ JPAí…ŒìŠ¤íŠ¸ì— ê´€ë ¨ëœ êµ¬ì„±ë§Œ ì ìš©í•˜ë„ë¡ í•œë‹¤.
2. í…ŒìŠ¤íŠ¸ì˜ ëì—ëŠ” Transactionì´ Rolll-backëœë‹¤. ë˜í•œ in-memory ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ìš©í•œë‹¤. 
3. @AutoConfigureTestDatabaseë¥¼ overideí•´ì„œ ì„¸íŒ…ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤.
4. Full-configuration ìƒíƒœë¥¼ Loadí•˜ê³  ë‚´ì¥ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´, @SpringBootTestë¥¼ ì‚¬ìš©í•˜ê³  @AutoConfigureTestDatabaseë¥¼ ì‚¬ìš©í•´ë¼

Repository Layerì—ì„œ Testí•  ë‚´ìš©ì€ ?

ğŸ‘‰Â CRUD ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸(Unit Test)

Repository Layer â†’ ORM ê¸°ìˆ ì„ ì§€ì›í•˜ëŠ” ê³„ì¸µ, ì‘ì„±ëœ Entityì˜ CRUDê¸°ëŠ¥ì„ ì˜ ìˆ˜í–‰í•˜ëŠ” ê°€ë¥¼ í…ŒìŠ¤íŠ¸ í•  í•„ìš”ì„±ì´ ìˆë‹¤.

í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ğŸ‘‡

```java
@DataJpaTest
class ParkRepositoryTest {
    @Autowired
    private ParkRepository parkRepository;

    private Local local = new Local("TESTNAME",1d,1d);
    private Address address = address = new Address("TEST ADDR NAMEDETAIL");;
    private String content = "TESTCONTENT";

    private Park createEntity(String name)
    {
        return new Park(name,local,address,content,null);
    }
    //CRUD -> Create, Read, Update, Delete
    @Test
    @DisplayName("CREATE ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸")
    void save() {
        //given
        Park entity = createEntity("TEST");
        ReflectionTestUtils.setField(entity,"id",1L);

        //when
        Park save = parkRepository.save(entity);

        //then
        Assertions.assertThat(save).isNotNull();
        Assertions.assertThat(save.getId()).isEqualTo(entity.getId());
    }
    @Test
    @DisplayName("ë‹¨ê±´ ì¡°íšŒ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸")
    void findParkInfoById() {
        //given
        Park entity1 = createEntity("TEST");
        ReflectionTestUtils.setField(entity1,"id",1L);
        Park entity2 = createEntity("TEST2");
        ReflectionTestUtils.setField(entity2,"id",2L);
        Park entity3 = createEntity("TEST3");
        ReflectionTestUtils.setField(entity3,"id",3L);
        Park save1 = parkRepository.save(entity1);
        Park save2 = parkRepository.save(entity2);
        Park save3 = parkRepository.save(entity3);

        //when
        Optional<Park> findOne = parkRepository.findParkInfoById(1L);
        Optional<Park> findTwo = parkRepository.findParkInfoById(2L);
        Optional<Park> findThree = parkRepository.findParkInfoById(3L);
        Optional<Park> findNotExist = parkRepository.findParkInfoById(4L);

        //then
        Assertions.assertThat(findOne).isNotNull();
        Assertions.assertThat(findTwo).isNotNull();
        Assertions.assertThat(findThree).isNotNull();
        Assertions.assertThat(findNotExist).isNull();
        Assertions.assertThat(findOne.get().getId()).isEqualTo(entity1.getId());
    }
    @Test
    @DisplayName("ëª¨ë“  Entity ì¡°íšŒ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸")
    void findAll() {
        //given
        Park entity1 = createEntity("TEST");
        ReflectionTestUtils.setField(entity1,"id",1L);
        Park entity2 = createEntity("TEST2");
        ReflectionTestUtils.setField(entity2,"id",2L);
        Park entity3 = createEntity("TEST3");
        ReflectionTestUtils.setField(entity3,"id",3L);
        Park save1 = parkRepository.save(entity1);
        Park save2 = parkRepository.save(entity2);
        Park save3 = parkRepository.save(entity3);
        //when
        List<Park> findAll = parkRepository.findAll();

        //then
        Assertions.assertThat(findAll.size()).isEqualTo(3);
        Assertions.assertThat(findAll.get(0).getId()).isEqualTo(entity1.getId());
        Assertions.assertThat(findAll.get(0).getName()).isEqualTo(entity1.getName());
    }
}
```

ìœ„ ì½”ë“œë¥¼ ì‘ì„±í•œ í›„ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ë³´ì•˜ë‹¤.

ê²°ê³¼ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.

![Untitled 2](https://user-images.githubusercontent.com/77047099/218371891-c82725de-9bdc-4652-bab7-b063d2f1e534.png)

ê·¸ ì´ìœ ëŠ” ParkRepository ì£¼ì…ë°›ëŠ” ì–´ë…¸í…Œì´ì…˜ì¸ @Autowiredì—ì„œ ë°œìƒí–ˆë‹¤.

@Autowired ì–´ë…¸í…Œì´ì…˜ì€ Inversion of Control Container ì— ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì–´ìˆëŠ” í´ë˜ìŠ¤ë¥¼ ì¸ìŠ¤í„´ìŠ¤ì™€ í•´ì„œ ìë™ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ì£¼ì…í•´ì¤€ë‹¤.

ì¦‰, ParkRepositoryë¼ëŠ” ì´ë¦„ì˜ Beanì„ ì°¾ì•„ ì¸ìŠ¤í„´ìŠ¤í™”í•˜ì—¬ ë°˜í™˜í•˜ì—¬ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

í•˜ì§€ë§Œ, @DataJpaTest Annotationì„ í†µí•´ Loadë˜ëŠ” ì»¨í…ìŠ¤íŠ¸ë“¤ ì¤‘ì— ì‘ì„±í•œ ParkRepository í´ë˜ìŠ¤ê°€ í¬í•¨ë˜ì§€ ì•Šì•˜ê³ , @Autowiredë¥¼ í†µí•´ ì£¼ì…ë°›ì„ Beanì„ ì°¾ì§€ ëª»í–ˆë‹¤ëŠ” ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¨ ê²ƒì´ë‹¤.

ê·¸ë ‡ë‹¤ë©´, ì™œ í¬í•¨ë˜ì§€ ì•Šì•˜ì„ê¹Œ? 

![Untitled 3](https://user-images.githubusercontent.com/77047099/218371900-60d7153c-f2ba-4a7b-8bf6-95b70bdf852f.png)

@DataJpaTest ì—ì„œ Regular @Component ì™€ @ConfigurationProperties ë¹ˆì€ ìŠ¤ìº”ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  ë¬¸ì„œì— ì í˜€ìˆê³ , ì˜¤ì§ @Entity í´ë˜ìŠ¤ì™€ Spring Data Jpa repositoriesë§Œ ìŠ¤ìº”í•œë‹¤ê³  ì í˜€ìˆë‹¤.

ë‚´ê°€ ì‘ì„±í•œ ParkRepositoryëŠ” Custom Jpa Repositoryë¡œ full-contextë¥¼ loadí•  ë•Œ loadë  ê²ƒì´ë‹¤.

ë”°ë¼ì„œ DataJpaTestì˜ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¡œë“œë˜ì§€ ì•Šì€ ê²ƒì´ë‹¤.

ì–´ë–»ê²Œ í•´ê²°í•´ì•¼í• ê¹Œ ?

1. @DataJpaTestê°€ ì•„ë‹Œ SpringBootTestë¡œ Repositoryë¥¼ í…ŒìŠ¤íŠ¸ í•œë‹¤.
â‡’ Unit Testê°€ ì•„ë‹Œ ì¢…ì†ì„±ì„ ê°€ì§€ëŠ” Integration testê°€ ëœë‹¤.
2. @DataJpaTest Component scan ì˜µì…˜ì„ ì„¤ì •í•˜ì—¬ Custom Repository Classë¥¼ ìŠ¤ìº”í•˜ë„ë¡ ì„¤ì •í•œë‹¤.

ë‹¤ë¥¸ ë°©ë²•ë“¤ë„ ìˆê² ì§€ë§Œ ë‚œ 2ë²ˆ ë°©ë²•ì„ ì„ íƒí•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰ í•´ ë³´ì•˜ë‹¤.

ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ `@DataJpaTest`ë¥¼ `@DataJpaTest(includeFilters = @ComponentScan.Filter(type = FilterType.*ANNOTATION*,classes = Repository.class))`

ë¡œ ì„¤ì •í•˜ì—¬ Repository ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ìŠ¤ìº”í•˜ë„ë¡ ì„¤ì •í–ˆë‹¤.

![Untitled 4](https://user-images.githubusercontent.com/77047099/218371907-e91b2d44-e97a-4b43-9365-0cee437f0c8a.png)

í…ŒìŠ¤íŠ¸ì— ì„±ê³µí–ˆë‹¤.

ë‹¤ë¥¸ í•œ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ @MockBean ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆì—ˆë‹¤.

í´ë˜ìŠ¤ ë ˆë²¨ê³¼ í•„ë“œ ë ˆë²¨ë¡œ ì„ ì–¸í•  ìˆ˜ ìˆìœ¼ë©°, íŠ¹ì • ê°ì²´ë¥¼ mockìœ¼ë¡œ ë§Œë“¤ì–´ Spring Application Contextì— ì¶”ê°€ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

mockbeanìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ê°ì²´ëŠ” ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ì— ë¹ˆìœ¼ë¡œ ì˜¬ë¼ê°€ëŠ” @RestController, @Service, @Repository ë“±ì´ ìˆë‹¤.
ë”°ë¼ì„œ, ParkRepositoryí´ë˜ìŠ¤ë¥¼ mockbeanìœ¼ë¡œ ë§Œë“¤ì–´ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ë„ ìˆì—ˆë‹¤.

í•˜ì§€ë§Œ, Mockbeanì€ ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ë¶ˆëŸ¬ì™€ íŠ¹ì • ê°ì²´ë§Œ mockìœ¼ë¡œ êµ¬ì„±í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ unit testì—ì„œ ì í•©í•˜ì§€ ì•Šë‹¤ëŠ” ìƒê°ì´ ë“ ë‹¤.

### Web Layer Test

@WebMvcTestë€ ?

Spring MVC Componentì— ì§‘ì¤‘í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜

![Untitled 5](https://user-images.githubusercontent.com/77047099/218371925-b2d8def3-7aac-4b42-a79a-cc96978e936e.png)

ìš”ì•½ :

1. ì „ì²´ ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ, MVCì™€ ê´€ë ¨ëœ ì»´í¬ë„ŒíŠ¸ë§Œ Loadí•œë‹¤.(@Controller, @ControllerAdviceâ€¦ë“±)
2. ê¸°ë³¸ìœ¼ë¡œ, @WebMvcTestëŠ” Spring Securityì™€ MockMvcë¥¼ ì œê³µí•œë‹¤.
3. @MockBean ê³¼ @Importë¥¼ ì´ìš©í•œ ì„¤ì •ì´ ê°€ëŠ¥í•˜ë‹¤.

Web Layerì—ì„œ í…ŒìŠ¤íŠ¸ í•  ë‚´ìš© ?
ê¸°ë³¸ì ìœ¼ë¡œ Web LayerëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ê³¼ ì‘ë‹µì„ ì²˜ë¦¬í•˜ëŠ” ê³„ì¸µì´ë‹¤. ë”°ë¼ì„œ, ì„¤ê³„ ìƒ ìš”êµ¬ì‚¬í•­ëŒ€ë¡œ ìš”ì²­ê³¼ ì‘ë‹µì´ ì´ë£¨ì–´ì§€ëŠ” ì§€ë¥¼ í…ŒìŠ¤íŠ¸ í•  í•„ìš”ê°€ ìˆë‹¤.

Web Layerì—ì„œ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë¡œì§ì—ëŠ” Serviceê³„ì¸µì˜ ë„ì›€ì„ ë°›ê³  í•´ë‹¹ ì‘ë‹µì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ” Repository ê³„ì¸µê¹Œì§€ë„ ì˜ì¡´ì„±ì´ í•„ìš”í•˜ë‹¤. 

ë…ë¦½ì ì¸ í™˜ê²½ ì¦‰, Serviceì™€ Repositoryì˜ ì˜ì¡´ì„±ì„ ëŠê³  í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  í•„ìš”ì„±ì´ ìˆë‹¤.

![Untitled 6](https://user-images.githubusercontent.com/77047099/218371931-af372df6-4e38-4189-842f-4156f3f085d8.png)

ë…ë¦½ì ì¸ í™˜ê²½ì„ ìœ„í•´ì„œ Spring Application Contextì—ì„œ Webê³¼ ê´€ë ¨ëœ í™˜ê²½ë§Œ Loadí•˜ê³  ì˜ì¡´ì„±ì¸ Repository, ServiceëŠ” MockBeanìœ¼ë¡œ ë“±ë¡í•´ì„œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë™ì‘í•  ìˆ˜ ìˆë‹¤.

ì‹¤ì œ ì›¹ ì„œë²„ë¥¼ ë™ì‘ì‹œí‚¤ì§€ ì•Šê³  inside-serverë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤. ì´ëŠ” ì „ì²´ ì›¹ ì„œë²„ì˜ í–‰ë™ì„ mockí•´ì„œ ì§„í–‰í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ê°€ëŠ¥í•˜ë‹¤.

![Untitled 7](https://user-images.githubusercontent.com/77047099/218371935-83ca8b3a-3b7c-42d3-844b-d64996f6cf2c.png)

ë‹¤ìŒì€ ì‘ì„±ëœ ì»¨íŠ¸ë¡¤ëŸ¬ì´ë‹¤. 
ìš”êµ¬ ì‚¬í•­ìœ¼ë¡œëŠ” 

1. â€œapi/v1/parks/{parkId}â€ë¡œ HTTP GET ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ í•´ë‹¹í•˜ëŠ” parkIdì˜ parkì •ë³´ê°€ ì‘ë‹µìœ¼ë¡œ ë°˜í™˜í•œë‹¤.
2. â€œapi/v1/parks/nearestâ€ë¡œ HTTP GET ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ í˜„ì¬ ìœ„ì¹˜ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ parkì •ë³´ë¥¼ ì‘ë‹µìœ¼ë¡œ ë°˜í™˜í•œë‹¤.

í…ŒìŠ¤íŠ¸ í•  ë‚´ìš©ì€ Client ì™€ Server ë‹¨ìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ì•¼ í•  í•„ìš”ê°€ ìˆë‹¤. **ì´ë²ˆ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” Server ë‹¨ì˜ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸ í•  ê²ƒì´ë‹¤.**

- Client â‡’ requestë¡œ ì–´ë–¤ ë‚´ìš©ì´ êµ¬ì„±ë˜ì–´ ìˆëŠ”ì§€, ì–´ë–¤ http methodë¥¼ ì‚¬ìš©í•˜ëŠ” ì§€ ê²€ì¦
- Server â‡’ clientì˜ requestë¥¼ mockìœ¼ë¡œ êµ¬ì„±í•˜ì—¬ ì„œë²„ì˜ ê¸°ëŠ¥ ê²€ì¦

ë¨¼ì € ê°„ë‹¨í•˜ê²Œ Serviceë¥¼ Mock ê°ì²´ë¡œ ë§Œë“  í›„ MockMvcë¡œ ìš”ì²­ì„ ë°›ì•„ì™€ì„œ HttpStatusë¥¼ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤.

![Untitled 8](https://user-images.githubusercontent.com/77047099/218371940-79f8caba-8f26-4efa-8b10-128cfd4c49fb.png)

í…ŒìŠ¤íŠ¸ ê²°ê³¼

![Untitled 9](https://user-images.githubusercontent.com/77047099/218371946-3dcab1d6-eb2d-46a8-a7b7-78e5b5665629.png)

401 Error ë°œìƒ â—

ì´ìœ ëŠ” â‡’ WebMvcTest ì–´ë…¸í…Œì´ì…˜ì€ Web Contextë¥¼ ê°€ì ¸ì™€ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•œë‹¤. ì´ë•Œ, Contextì— Spring Securityê°€ í¬í•¨ë˜ê³ , ì¸ê°€ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ HTTP ìš”ì²­ì„ ë³´ëƒˆì„ ë•Œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ì¸ 401ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.

ì´ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ê¶Œí•œì´ í•„ìš”í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

(ìë™ì ìœ¼ë¡œ SpringBootWebSecurityConfigurationë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.)

ë”°ë¼ì„œ, ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìì˜ í™˜ê²½ì„ ë§Œë“¤ì–´ì•¼ ë  í•„ìš”ê°€ ìˆì—ˆë‹¤.

@WithMockUser ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ì í™˜ê²½ì„ ì„¤ì •í•  ìˆ˜ ìˆì—ˆë‹¤.

![Untitled 10](https://user-images.githubusercontent.com/77047099/218371955-9f89e2d1-311d-401c-84b1-07ec0ac1f2cc.png)

ê¶Œí•œ ìˆ˜ì • ì´í›„, response ì•ˆì— Dtoë¡œ ë°›ì•„ì˜¨ Entityê°’ì´ ì˜ ë“¤ì–´ì™”ëŠ”ì§€ ê²€ì¦í•˜ëŠ” ë¶€ë¶„ì„ ì¶”ê°€í•˜ì˜€ë‹¤.

![Untitled 11](https://user-images.githubusercontent.com/77047099/218371961-588e29fc-62ce-4d57-ac3e-16b5228cffe4.png)

AssertThatì— ë„˜ì–´ì˜¤ëŠ” Bodyê°€ Jsoní˜•ì‹ì´ì§€ë§Œ í¬ë§·ì´ ê°™ì´ ë„˜ì–´ì˜¤ì§€ ì•Šì•„ Stringìœ¼ë¡œ ê²€ì¦í•˜ì˜€ë‹¤.

![Untitled 12](https://user-images.githubusercontent.com/77047099/218372000-a8fb7ad6-732b-4046-9ff7-aa022277a013.png)

![Untitled 13](https://user-images.githubusercontent.com/77047099/218372005-6f50fabe-0e10-4139-ade9-274feb679a06.png)

ë‹¤ìŒ í…ŒìŠ¤íŠ¸ì¸ â€œapi/v1/parks/nearestâ€ì˜ APIë¥¼ í…ŒìŠ¤íŠ¸ í–ˆë‹¤.

í˜„ì¬ ìœ„ì¹˜ë¥¼ Parameterë¡œ ë°›ì•„ ê°€ì¥ ê°€ê¹Œìš´ ì£¼ì°¨ì¥ì˜ ì •ë³´ë¥¼ ë°˜í™˜í•˜ëŠ” ê¸°ëŠ¥ì´ê³ 

í˜¸ì¶œ ì‹œ ì‘ë‹µìœ¼ë¡œ NearestParkDtoë¥¼ ë°˜í™˜í•œë‹¤.

í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ğŸ‘‡

![Untitled 14](https://user-images.githubusercontent.com/77047099/218372014-60ebc215-8771-471a-afd3-13a97695cbd5.png)

ê²°ê³¼ ğŸ‘‡

![Untitled 15](https://user-images.githubusercontent.com/77047099/218372023-c523402e-1524-49a4-98fd-ca9c248567d2.png)

ìµœì¢… ê²°ê³¼ 

![Untitled 16](https://user-images.githubusercontent.com/77047099/218372034-895eb473-16d4-402a-8f76-bdec077965cc.png)
