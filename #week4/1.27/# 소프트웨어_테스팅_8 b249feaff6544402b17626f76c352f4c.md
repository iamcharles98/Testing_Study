# # ì†Œí”„íŠ¸ì›¨ì–´_í…ŒìŠ¤íŒ…_8

ìƒì„± ì¼ì‹œ: 2023ë…„ 1ì›” 27ì¼ ì˜¤í›„ 7:12

## Spring TestContext Framework

org.springframework.test.contextì— í¬í•¨

annotation-driven unit & integration test ì§€ì›

- TestContextManager â†’ ê° í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë§ˆë‹¤ ë§Œë“¤ì–´ì§„ë‹¤. ì´í›„ í…ŒìŠ¤íŠ¸ íë¦„ì„ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
- TestContext â†’ í˜„ì¬ í…ŒìŠ¤íŠ¸ì˜ íë¦„ì„ ê°€ì§€ê³  ìˆë‹¤. í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ë§¤ë‹ˆì ¸ì— ì˜í•´ ìƒíƒœ ë³€ì´ê°€ ì¼ì–´ë‚œë‹¤.
- TestExecutionListener â†’ ì—¬ëŸ¬ ê°€ì§€ì˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰íë¦„ì„ ì œê³µí•œë‹¤. 
ServletTestExecutionListener â†’ WebApplicationContextë¥¼ ìœ„í•´ ì‚¬ìš©ë  mockì„ ìƒì„±í•˜ëŠ” API
DependencyInjectionTestExecutionListener â†’ test instanceì— DIë¥¼ ì œê³µ

```java
public interface TestExecutionListener {
	default void beforeTestClass(TestContext testContext) throws Exeption{} ;
	default void prepareTestInstance(TestContext testContext) throws Exeption{} ;
	default void beforeTestMethod(TestContext testContext) throws Exeption{} ;
...
}
```

TestExecutionListener ì¸í„°í˜ì´ìŠ¤ë¥¼ implementsí•˜ë©´ Spring ì—ì„œ ì œê³µí•˜ëŠ” contextë¥¼ ë°›ì•„ í…ŒìŠ¤íŠ¸ ì‘ì„±ì„ í•  ìˆ˜ ìˆë‹¤.

- SmartContextLoader â†’ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì— ApplicatonContextë¥¼ loadí•˜ëŠ” ì—­í• 

### WebTestClient

â‡’ Http client designed for testing server applications

ìš”ì²­ê³¼ ì‘ë‹µì„ í…ŒìŠ¤íŒ…í•˜ëŠ” ê²ƒì„ ì§€ì›í•˜ê¸° ìœ„í•œ ê¸°ëŠ¥, end-to-end http test

Spring MVC testë¥¼ í•  ë•Œ, ì‘ë™í•˜ëŠ” ì„œë²„ ì—†ì´ Mock ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ ì‘ë‹µì„ ë°›ëŠ” ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.

**Set Up**

1. Bind to Controller
ì‘ë™í•˜ëŠ” ì„œë²„ê°€ ì—†ì–´ë„ Mock request ì™€ Mock response objectë¡œ controller í…ŒìŠ¤íŒ…ì´ ê°€ëŠ¥í•˜ë„ë¡ ì¤€ë¹„í•œë‹¤.
`WebTestClient client =` 
    
    `MockMvcWebTestClient.bindToController(new TestController).build();`
    
2. Bind to ApplicationContext
load Spring configuration with Spring MVC and contoller declaration and use it to handle request via mock request and reponse objects without a running server.

```java
@ExtendWith(SpringExtension.class)
@WebAppConfiguration("classpath:META-INF/web-resources")
@ContextHierarchy({
	@ContextConfiguration(classes = RootConfig.class),
	@ContextConfiguration(classes = WebConfig.class)
})
class MyTests {
@Autowired
WebApplicationContext wac;

WebTestClient client;

@BeforeEach
public void setUp(Application context) {
	client = MockMvcWebTestClient.bindToApplicationContext(this.wac).build();
}
```

setupì˜ ì¸ìë¡œ @SpringJUnitConfigì—ì„œ loadí•œ contextë¥¼ ë°›ì•„ WebTestClientì— bind í•œë‹¤.
@WebAppConfiguration â†’ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë¶€íŠ¸ìŠ¤íŠ¸ë© ëœ ApplicationContextê°€ WebApplicationì»¨í…ìŠ¤íŠ¸ì˜ ì¸ìŠ¤í„´ìŠ¤ ì—¬ì•¼í•¨ì„ ë‚˜íƒ€ë‚¸ë‹¤.

1. Bind to Server
`client = WebTestClient.bindToServer().baseUrl(â€http://localhost:8080â€).build();`
Running serverì™€ ì—°ê²° ì§€ì›
2. Client Config
`client = WebTestClient.bindToControler(new TestController()).configureClient().baseUrl(â€/testâ€).build();`

<aside>
ğŸŒ± Test ì‘ì„±
`client.get().url(â€/persons/1â€)
.accept(MediaType.APPLICATION_JSON)
.exchange().
expectStatus().isOk().
expectHeader().contentType(MediaType.APPLICATION_JSON);`

</aside>

---

### MockMVC

Spring MVC testingì„ ì§€ì›í•˜ëŠ” framework

<aside>
ğŸŒ± ì´ í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•˜ë©´ Spring MVCì— ëŒ€í•´ì„œ Unit Testë¥¼ í•  ìˆ˜ ìˆë‹¤.
Dependency Injectionì´ ê°€ëŠ¥í•˜ê³  Mockê°ì²´ë¥¼ ì´ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.
í•˜ì§€ë§Œ ì´ë ‡ê²Œ ì‘ì„±ëœ unit testëŠ” request mapping, data binding ë“±ì„ ê²€ì¦í•˜ëŠ” ê²ƒì€ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.
**Running Server ì—†ì´ Spring Controllerì˜ ë™ì‘ì„ í…ŒìŠ¤íŒ… í•  ìˆ˜ ìˆë„ë¡ ëª©ì **ì„ ë‘” í”„ë ˆì„ì›Œí¬ì´ë‹¤.
DispatcherServletì„ í˜¸ì¶œí•´ì„œ Servlet APIì˜ ë™ì‘ì„ Mockí•´ì„œ ì „ë‹¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ë™í•œë‹¤.

</aside>